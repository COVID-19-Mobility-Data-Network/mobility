<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tools for analyzing human mobility data â€¢ mobility</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Tools for analyzing human mobility data">
<meta property="og:description" content="Functions for parsing travel data, fitting models using Bayesian inference, and simulating mobility patterns.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">mobility</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/V1_data_template.html">A generalized format for longform travel data</a>
    </li>
    <li>
      <a href="articles/V2_build_matrices.html">Building matrices from longform travel data</a>
    </li>
    <li>
      <a href="articles/V3_travel_probability.html">Fitting and simulating travel probability</a>
    </li>
    <li>
      <a href="articles/V4_gravity_compendium.html">A compendium of diffusion models</a>
    </li>
    <li>
      <a href="articles/V4_gravity_model.html">Fitting and simulating a gravity model</a>
    </li>
    <li>
      <a href="articles/V5_mobility_model.html">Fitting and simulating a full mobility model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/COVID-19-Mobility-Data-Network/mobility/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="mobility-an-r-package-for-modeling-human-mobility-patterns" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#mobility-an-r-package-for-modeling-human-mobility-patterns" class="anchor"></a><code>mobility</code>: an R package for modeling human mobility patterns</h1></div>
<p>This GitHub repository contains source code to build the <code>mobility</code> R package which provides tools for analyzing human mobility data, including functions for parsing travel data, fitting mobility models using Bayesian inference, and simulating mobility patterns. This package is currently in development and maintained by John Giles (<a href="https://github.com/gilesjohnr">@gilesjohnr</a>) and Amy Wesolowski.</p>
<div id="rationale" class="section level2">
<h2 class="hasAnchor">
<a href="#rationale" class="anchor"></a>Rationale</h2>
<p>Recently there has been a surge in research that incorporates human mobility data into epidemiological models. Depending on the context, mobility data can be derived from multiple sources such as GPS tracking studies, travel surveys, call data records, or mobile phone applications with location services. In addition, widespread social distancing measures that have been implemented to slow COVID-19 transmission have spurred several technology companies in the private sector to make data collected by mobile phone applications publicly available. A particular advantage lended by these data is that they offer real-time or near-real-time measures of human mobility at a high spatial resolution, leading to an increased interest in incorporating real-time data on human mobility into spatial models of disease transmission. Given the multitude of mobility data types now available and the impetus to use them in disease models, we developed the R package <code>mobility</code> which provides tools to help public health researchers fit and simulate mobility models using different sources of human mobility data. The package will undergo continued development as methods evolve to meet current demand.</p>
</div>
<div id="challenges" class="section level2">
<h2 class="hasAnchor">
<a href="#challenges" class="anchor"></a>Challenges</h2>
<p>Although the initial format of each data type may be different, there are general challenges regarding data sparsity, spatial scale, and statistical uncertainty that make direct use of mobility data in modeling pipelines challenging:</p>
<ul>
<li><p><strong>Data sparsity</strong> occurs when observations for some routes of travel are missing, making it difficult to generalize observed mobility patterns for routes of travel that are unobserved. We address data sparsity by fitting mobility models to the data that are observed and then inferring travel for unobserved routes based on estimated model parameters.</p></li>
<li><p>The <strong>spatial scale</strong> of the mobility data is often different from that needed by the epidemiological model. Functions in this package account for differences in spatial scale by aggregating travel patterns to a larger spatial scale or extrapolating them to a smaller one using covariates such as distance and population size.</p></li>
<li><p><strong>Statistical uncertainty</strong> in the travel patterns found in human mobility data results from the variance in a naturally stochastic process. Depending on the method used to collect the mobility data and the subset of the population represented, measurement error and observation bias also have an impact. To facilitate integration of mobilty model uncertainty into disease models, we provide model fitting and simulation tools that allow researchers to simulate the mobility process according to the distribution of estimated model parameters.</p></li>
</ul>
</div>
<div id="tools" class="section level2">
<h2 class="hasAnchor">
<a href="#tools" class="anchor"></a>Tools</h2>
<p>To help facilitate modeling studies that wish to use mobility data and address the challenges above, we have developed a suite of tools that can be used to do some of the heavy lifting required to fit and simulate mobility models. Sections below show the general work-flow, see the package vignettes for more detailed examples.</p>
<div id="general-work-flow" class="section level3">
<h3 class="hasAnchor">
<a href="#general-work-flow" class="anchor"></a>General work-flow</h3>
<p><img src="reference/figures/workflow/workflow.001.png"></p>
</div>
<div id="generalized-long-form-mobility-data-format" class="section level3">
<h3 class="hasAnchor">
<a href="#generalized-long-form-mobility-data-format" class="anchor"></a>1. Generalized long-form mobility data format</h3>
<p>There are many sources of travel data that researchers wish to fit models to. So, we have designed a generalized data frame template to standardize travel data from various sources into a longform format that is compatible with the modeling and simulation tools in this package. This data template can be populated by starting with the <code>travel_data_template</code> object and adding rows.</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">mobility</span>)
<span class="no">mobility_data</span> <span class="kw">&lt;-</span> <span class="no">travel_data_template</span>
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fl">5</span> <span class="co"># Add some observations</span>
<span class="no">mobility_data</span>[<span class="fl">1</span>:<span class="no">n</span>,] <span class="kw">&lt;-</span> <span class="fl">NA</span>
<span class="co"># add data mobility data to rows</span></pre></div>
</div>
<div id="build-sparse-data-matrices-for-modeling" class="section level3">
<h3 class="hasAnchor">
<a href="#build-sparse-data-matrices-for-modeling" class="anchor"></a>2. Build sparse data matrices for modeling</h3>
<p>Utility functions take mobility data from the generalized long-form format and build data matrices that are used to fit models.</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="no">mobility_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">mobility_data</span>, <span class="fu"><a href="reference/get_unique_ids.html">get_unique_ids</a></span>(<span class="no">mobility_data</span>, <span class="kw">adm_start</span><span class="kw">=</span><span class="fl">2</span>))

<span class="co"># Sparse matrix containing trip counts</span>
<span class="no">M</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/get_mob_matrix.html">get_mob_matrix</a></span>(<span class="kw">orig</span><span class="kw">=</span><span class="no">mobility_data</span>$<span class="no">orig_id</span>,
                    <span class="kw">dest</span><span class="kw">=</span><span class="no">mobility_data</span>$<span class="no">dest_id</span>,
                    <span class="kw">value</span><span class="kw">=</span><span class="no">mobility_data</span>$<span class="no">trips</span>)

<span class="co"># Distance matrix containing distances among all locations</span>
<span class="no">xy</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/get_unique_coords.html">get_unique_coords</a></span>(<span class="no">mobility_data</span>)
<span class="no">D</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/get_distance_matrix.html">get_distance_matrix</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">xy</span>[,<span class="fl">1</span>],
                         <span class="kw">y</span><span class="kw">=</span><span class="no">xy</span>[,<span class="fl">2</span>],
                         <span class="kw">id</span><span class="kw">=</span><span class="no">xy</span>[,<span class="fl">3</span>])

<span class="co"># Unique population sizes for all locations</span>
<span class="no">N</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/get_pop_vec.html">get_pop_vec</a></span>(<span class="no">mobility_data</span>)</pre></div>
</div>
<div id="estimate-mobility-model-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#estimate-mobility-model-parameters" class="anchor"></a>3. Estimate mobility model parameters</h3>
<div class="sourceCode" id="cb3"><pre class="r"># Fit a mobility model to data matrices
mod &lt;- fit_mobility(M, D, N)

# Summary statistics of parameter estimates
summarize_mobility(mod)

               Mean          SD       HPD2.5    HPD97.5 Rhat SSeff          AC5
gamma   1.627564815 0.012987392 1.601657e+00 1.65184147 1.01  1155 -0.007112479
omega_1 2.155448977 1.905316057 1.135895e-02 5.88730404 1.00   486  0.154469676
omega_2 0.593836446 0.403373442 2.720367e-05 1.32248529 1.00   704  0.104623413
theta   2.007748972 2.006350454 2.338955e-03 5.93925457 1.00   384  0.207985294
tau_1   0.616436441 0.006884550 6.032836e-01 0.62982560 1.00  1264  0.016804072
tau_2   0.432084468 0.007734690 4.174996e-01 0.44721031 1.00  1159  0.022767959
tau_3   0.431438676 0.007126530 4.174066e-01 0.44479338 1.00  1261  0.022528656
tau_4   0.384766345 0.250618523 2.148511e-07 0.84557558 1.00  2000  0.001937946
tau_5   0.008924998 0.001340494 6.292020e-03 0.01137737 1.00  1243  0.010289810

# Check goodness of fit
check_mobility(M, D, N, mod)</pre></div>
<p><img src="reference/figures/model_check.png" width="700"></p>
</div>
<div id="simulate-mobility-model" class="section level3">
<h3 class="hasAnchor">
<a href="#simulate-mobility-model" class="anchor"></a>4. Simulate mobility model</h3>
<div class="sourceCode" id="cb4"><pre class="r"># Simulate one stochastic realization of mobility matrix using fitted mobility model parameters
sim_mobility(D, N, mod, n=1)
             
      destination
origin           A          B          C           D          E
     A 0.287432109 0.04218981 0.02230203 0.062559887 0.03429974
     B 0.022199446 0.48642730 0.05553207 0.009403616 0.07279978
     C 0.005880424 0.02782746 0.86158241 0.003194057 0.02459956
     D 0.151346825 0.04323522 0.02930595 0.378491474 0.03955175
     E 0.019122996 0.07713662 0.05201496 0.009114932 0.51987329</pre></div>
<p>Please see package vignettes to explore each step in more detail.</p>
</div>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<div id="step-1-check-that-jags-4-3-0-is-installed" class="section level4">
<h4 class="hasAnchor">
<a href="#step-1-check-that-jags-4-3-0-is-installed" class="anchor"></a>Step 1: Check that JAGS 4.3.0 is installed</h4>
<p>The model fitting functions in the package perform parameter estimation using the Bayesian MCMC (Markov Chain Monte Carlo) algorithm called JAGS (Just Another Gibbs Sampler), which requires the JAGS library version &gt;= 4.3.0 to be installed.</p>
<ul>
<li>If you do not have the JAGS 4.3.0 library installed, download <a href="https://sourceforge.net/projects/mcmc-jags/files/">HERE</a>.</li>
<li>If you already have an installation of the JAGS library, check that the version is &gt;= 4.3.0 by opening your console and typing <code>jags</code> which should give you the following message:</li>
</ul>
<pre class="console"><code>user@computer:~$ jags
Welcome to JAGS 4.3.0 on Fri May  1 16:05:10 2020
JAGS is free software and comes with ABSOLUTELY NO WARRANTY
Loading module: basemod: ok
Loading module: bugs: ok
. </code></pre>
</div>
<div id="step-2-install-mobility-from-github" class="section level4">
<h4 class="hasAnchor">
<a href="#step-2-install-mobility-from-github" class="anchor"></a>Step 2: Install <code>mobility</code> from Github</h4>
<p>Use the <code>devtools</code> package to install the development version of <code>mobility</code> from the COVID-19-Mobility-Data-Network GitHub repository. The source code and its dependencies should be backwards compatible with previous R versions, but we recommend R version &gt;= 3.6.2.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">'devtools'</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">'COVID-19-Mobility-Data-Network/mobility'</span>)</pre></div>
</div>
</div>
<div id="troubleshooting" class="section level2">
<h2 class="hasAnchor">
<a href="#troubleshooting" class="anchor"></a>Troubleshooting</h2>
<p>For general questions, contact John Giles (<a href="mailto:giles@jhu.edu" class="email">giles@jhu.edu</a>) and/or Amy Wesolowski (<a href="mailto:awesolowski@jhu.edu" class="email">awesolowski@jhu.edu</a>). For technical questions, contact package maintainer John Giles (<a href="mailto:giles@jhu.edu" class="email">giles@jhu.edu</a>). To report bugs or problems with code or documentation, please go to the <a href="https://github.com/COVID-19-Mobility-Data-Network/mobility/issues">Issues</a> page associated with this GitHub page and click <em>new issue</em>.</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/COVID-19-Mobility-Data-Network/mobility/">https://â€‹github.com/â€‹COVID-19-Mobility-Data-Network/â€‹mobility/â€‹</a>
</li>
<li>Report a bug at <br><a href="https://github.com/COVID-19-Mobility-Data-Network/mobility/issues">https://â€‹github.com/â€‹COVID-19-Mobility-Data-Network/â€‹mobility/â€‹issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>John Giles <br><small class="roles"> Author, maintainer </small>  </li>
<li>Amy Wesolowski <br><small class="roles"> Author, contributor </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.com/COVID-19-Mobility-Data-Network/mobility"><img src="https://travis-ci.com/COVID-19-Mobility-Data-Network/mobility.svg?branch=master" alt="Travis build status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by John Giles, Amy Wesolowski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
