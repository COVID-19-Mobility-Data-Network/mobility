<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fitting and simulating a gravity model â€¢ mobility</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fitting and simulating a gravity model">
<meta property="og:description" content="mobility">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mobility</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/V1_data_template.html">A generalized format for longform travel data</a>
    </li>
    <li>
      <a href="../articles/V2_build_matrices.html">Building matrices from longform travel data</a>
    </li>
    <li>
      <a href="../articles/V3_travel_probability.html">Fitting and simulating travel probability</a>
    </li>
    <li>
      <a href="../articles/V4_gravity_model.html">Fitting and simulating a gravity model</a>
    </li>
    <li>
      <a href="../articles/V5_mobility_model.html">Fitting and simulating a full mobility model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/COVID-19-Mobility-Data-Network/mobility/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="V4_gravity_model_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fitting and simulating a gravity model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/COVID-19-Mobility-Data-Network/mobility/blob/master/vignettes/V4_gravity_model.Rmd"><code>vignettes/V4_gravity_model.Rmd</code></a></small>
      <div class="hidden name"><code>V4_gravity_model.Rmd</code></div>

    </div>

    
    
<p>Historically, the gravity model has been used to model connectivity among locations based on the distances among <span class="math inline">\(i\)</span> origins and <span class="math inline">\(j\)</span> destinations (<span class="math inline">\(d_{ij}\)</span>) and population sizes of each location (<span class="math inline">\(N_i\)</span> and <span class="math inline">\(N_j\)</span>). A major advantage of the gravity model is that distance and population size are simple covariates that can be obtained in almost any context, allowing a researcher to infer connectivity with little information.</p>
<p>When fitting the gravity model to data, we also need a matrix of observed travel volume (<span class="math inline">\(M\)</span>). Travel volume is an intentionally vague term here because a mobility data matrix can be populated with a variety of measurements that capture relative amounts of travel among locations. For example, if we are using Call Data Records (CDR) which are measures of mobile phone usage supplied by mobile phone companies, the unit of travel volume is likely to be the total number of person trips per unit time. Or if we are using a travel survey that researchers have collated from questionares given to residents of an area, the measurement of travel volume might be the total number of individuals that reported travelling from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> in the past month.</p>
<p>The actual unit of travel volume is less important when modeling connectivity because the gravity model formula estimates relative travel volume that is normalized across all <span class="math inline">\(j\)</span> destinations of an origin, so that the rows of <span class="math inline">\(M\)</span> sum to 1. However, it is important that all <span class="math inline">\(ij\)</span> cells in <span class="math inline">\(M\)</span> have the <strong>same</strong> unit of travel volume per unit time because the model estimates parameters based on relative differences in travel volume.</p>
<p>The rest of this vignette shows an example of how to estimate and simulate connectivity (<span class="math inline">\(\hat{\pi}_{ij}\)</span>) for all possible <span class="math inline">\(i \rightarrow j\)</span> travel routes found in supplied data matrices (<span class="math inline">\(M\)</span>, <span class="math inline">\(D\)</span>, and <span class="math inline">\(N\)</span>).</p>
<div id="build-data-matrices" class="section level3">
<h3 class="hasAnchor">
<a href="#build-data-matrices" class="anchor"></a>Build data matrices</h3>
<p>Before we can fit a gravity model, we must build data matrices from the longform travel data. The utility functions <code><a href="../reference/get_mob_matrix.html">get_mob_matrix()</a></code>, <code><a href="../reference/get_distance_matrix.html">get_distance_matrix()</a></code>, and <code><a href="../reference/get_pop_vec.html">get_pop_vec()</a></code> can be used to generate data matrices representing travel volume among locations (<span class="math inline">\(M\)</span>), along with distances (<span class="math inline">\(D\)</span>) and population sizes (<span class="math inline">\(N\)</span>). Here we use pre-built matrices from simulated data in the <code>mobiliy_matrices()</code> data object.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">M</span> <span class="kw">&lt;-</span> <span class="no">mobility_matrices</span>$<span class="no">M</span>
<span class="no">D</span> <span class="kw">&lt;-</span> <span class="no">mobility_matrices</span>$<span class="no">D</span>
<span class="no">N</span> <span class="kw">&lt;-</span> <span class="no">mobility_matrices</span>$<span class="no">N</span></pre></body></html></div>
<p>By design, we have added additional stochasticity around trip counts in the movement matrix (<span class="math inline">\(M\)</span>) and randomly sampled 80% of observed routes to simulate missing observations, which are shown as grey cells in the plot below.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu">ggplot</span>(<span class="kw">data</span><span class="kw">=</span><span class="fu">melt</span>(<span class="no">M</span>)) +
  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">destination</span>),
                <span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">origin</span>),
                <span class="kw">fill</span><span class="kw">=</span><span class="no">value</span>)) +
  <span class="fu">xlab</span>(<span class="st">'Destination'</span>) + <span class="fu">ylab</span>(<span class="st">"Origin"</span>) +
  <span class="fu">theme_bw</span>() + <span class="fu">theme</span>(<span class="kw">axis.text.x</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">10</span>),
                     <span class="kw">axis.text.y</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">10</span>),
                     <span class="kw">axis.title.x</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">12</span>, <span class="kw">margin</span> <span class="kw">=</span> <span class="fu">margin</span>(<span class="kw">t</span> <span class="kw">=</span> <span class="fl">15</span>)),
                     <span class="kw">axis.title.y</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">12</span>, <span class="kw">margin</span> <span class="kw">=</span> <span class="fu">margin</span>(<span class="kw">r</span> <span class="kw">=</span> <span class="fl">15</span>)),
                     <span class="kw">legend.position</span><span class="kw">=</span><span class="st">'bottom'</span>) +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>(<span class="kw">option</span><span class="kw">=</span><span class="st">'inferno'</span>, <span class="kw">direction</span><span class="kw">=</span><span class="fl">1</span>) +
  <span class="fu">guides</span>(<span class="kw">fill</span><span class="kw">=</span><span class="fu">guide_colorbar</span>(<span class="kw">title</span><span class="kw">=</span><span class="st">'Observed trips'</span>,
                             <span class="kw">title.position</span><span class="kw">=</span><span class="st">'top'</span>,
                             <span class="kw">label.theme</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">9</span>),
                             <span class="kw">barwidth</span><span class="kw">=</span><span class="fl">20</span>,
                             <span class="kw">barheight</span><span class="kw">=</span><span class="fl">0.5</span>,
                             <span class="kw">frame.colour</span><span class="kw">=</span><span class="st">'black'</span>,
                             <span class="kw">ticks</span><span class="kw">=</span><span class="fl">TRUE</span>))</pre></body></html></div>
<p><img src="V4_gravity_model_files/figure-html/data_plot-1.png" width="624"></p>
</div>
<div id="fit-gravity-model-to-data" class="section level3">
<h3 class="hasAnchor">
<a href="#fit-gravity-model-to-data" class="anchor"></a>Fit gravity model to data</h3>
<p>Gravity model parameters can be estimated using the <code><a href="../reference/fit_gravity.html">fit_gravity()</a></code> function. This function uses the distance among locations (<span class="math inline">\(D\)</span>) and population sizes (<span class="math inline">\(N\)</span>) as covariates in the gravity equation, which is fitted to the movement matrix (<span class="math inline">\(M\)</span>) with a Poisson likelihood link function: <span class="math display">\[
\begin{aligned}
        m_{ij} &amp;\sim \text{Poisson}\big(\pi_{ij}N_{i}\big)\\
        \pi_{ij} &amp;= c_{ij}/\sum_{\forall j}c_{ij} \\
        c_{ij} &amp;= \theta \Bigg(
        \frac{
        N_{i}^{\omega_1} N_{j}^{\omega_2}
        }{
        d_{ij}
        } \Bigg)
\end{aligned}   
\]</span> Gravity model parameters are fit through normalized connectivity values (<span class="math inline">\(\pi_{ij}\)</span>) that scale the Poission likelihood so that it is proportional to the observed trip counts (<span class="math inline">\(m_{ij}\)</span>). The exponential parameters <span class="math inline">\(\omega_1\)</span> and <span class="math inline">\(\omega_2\)</span> are weights that modify the contribution of origin and destination population sizes, and <span class="math inline">\(\theta\)</span> is a proportionality constant. The denominator of the gravity model, <span class="math inline">\(d_{ij}^\gamma\)</span>, serves as the dispersal kernel function. The fitting function <code><a href="../reference/fit_gravity.html">fit_gravity()</a></code> estimates the posterior distribution of model parameters using Bayesian MCMC inference.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">mod</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_gravity.html">fit_gravity</a></span>(<span class="kw">M</span><span class="kw">=</span><span class="no">M</span>,
                   <span class="kw">D</span><span class="kw">=</span><span class="no">D</span>,
                   <span class="kw">N</span><span class="kw">=</span><span class="no">N</span>,
                   <span class="kw">n_chain</span><span class="kw">=</span><span class="fl">2</span>,
                   <span class="kw">n_burn</span><span class="kw">=</span><span class="fl">1000</span>,
                   <span class="kw">n_samp</span><span class="kw">=</span><span class="fl">1000</span>,
                   <span class="kw">n_thin</span><span class="kw">=</span><span class="fl">2</span>,
                   <span class="kw">DIC</span><span class="kw">=</span><span class="fl">TRUE</span>)
<span class="co">#&gt; ::Fitting gravity model for 10 origins and 10 destinations::</span>
<span class="co">#&gt; Using uniformative priors</span>
<span class="co">#&gt; Compiling model graph</span>
<span class="co">#&gt;    Resolving undeclared variables</span>
<span class="co">#&gt;    Allocating nodes</span>
<span class="co">#&gt; Graph information:</span>
<span class="co">#&gt;    Observed stochastic nodes: 74</span>
<span class="co">#&gt;    Unobserved stochastic nodes: 30</span>
<span class="co">#&gt;    Total graph size: 1196</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Initializing model</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; NOTE: Stopping adaptation</span></pre></body></html></div>
<p>The above code fits the gravity model using 4 sampling chains, discards the first 1000 samples as â€˜burin inâ€™, and then takes 1000 samples thinning by 2 to give 500 total samples per chain. The <code>DIC=TRUE</code> argument tells the function to calculate the Deviance Information Criterion (DIC).</p>
<p>Running a gravity model on a large number of locations (e.g.Â <span class="math inline">\(\gt 100\)</span>) or drawing a large number of samples from posterior distributions (e.g.Â 10000) may take several minutes. If computation is cumbersome, then the model can run sampling chains in parallel instead of sequentially by specifying <code>parallel = TRUE</code>.</p>
<p>The fitting function <code><a href="../reference/fit_gravity.html">fit_gravity()</a></code> returns results as a <code><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">coda::mcmc.list()</a></code> object shown below. The <code><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html">coda::mcmc.list()</a></code> is a common object class that holds the posterior samples for each parameter and each sampling chain.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">mod</span>)
<span class="co">#&gt; List of 2</span>
<span class="co">#&gt;  $ : 'mcmc' num [1:500, 1:7] 35320 35317 35317 35317 35317 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : NULL</span>
<span class="co">#&gt;   .. ..$ : chr [1:7] "deviance" "gamma" "omega_1" "omega_2" ...</span>
<span class="co">#&gt;   ..- attr(*, "mcpar")= num [1:3] 1 500 1</span>
<span class="co">#&gt;  $ : 'mcmc' num [1:500, 1:7] 35318 35319 35318 35317 35317 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : NULL</span>
<span class="co">#&gt;   .. ..$ : chr [1:7] "deviance" "gamma" "omega_1" "omega_2" ...</span>
<span class="co">#&gt;   ..- attr(*, "mcpar")= num [1:3] 1 500 1</span>
<span class="co">#&gt;  - attr(*, "class")= chr "mcmc.list"</span></pre></body></html></div>
</div>
<div id="model-summary-and-validation" class="section level3">
<h3 class="hasAnchor">
<a href="#model-summary-and-validation" class="anchor"></a>Model summary and validation</h3>
<p>To calculate summary statistics of estimated parameter values, you can supply a fitted model object to the <code><a href="../reference/summarize_mobility.html">summarize_mobility()</a></code> function. This function is a wrapper for the <code><a href="https://rdrr.io/pkg/MCMCvis/man/MCMCsummary.html">MCMCvis::MCMCsummary()</a></code> function that calculates summary statistics for each parameter across each chain along with convergance diagnosics like the Gelman-Rubin convergence diagnostic and (<span class="math inline">\(\hat{R}\)</span>) and samples auto-correlation foreach parameter.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">mod</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/summarize_mobility.html">summarize_mobility</a></span>(<span class="no">mod</span>)
<span class="no">mod</span>
<span class="co">#&gt;                  Mean         SD       HPD2.5      HPD97.5 Rhat SSeff  AC2</span>
<span class="co">#&gt; gamma    1.724677e+00 0.01205471 1.699180e+00 1.746843e+00 1.01   927 0.07</span>
<span class="co">#&gt; omega_1  1.381750e+00 0.68366803 4.628563e-01 2.910332e+00 1.05   404 0.32</span>
<span class="co">#&gt; omega_2  3.098592e-02 0.01613333 2.629649e-03 6.193056e-02 1.00   864 0.10</span>
<span class="co">#&gt; theta    1.062420e+00 0.70814989 5.011071e-02 2.456657e+00 1.03   635 0.23</span>
<span class="co">#&gt; DIC      3.532755e+04 2.49634477 3.532475e+04 3.533239e+04 1.01   820 0.16</span>
<span class="co">#&gt; deviance 3.531912e+04 2.49634477 3.531633e+04 3.532397e+04 1.01   820 0.16</span>
<span class="co">#&gt; pD       4.211024e+00         NA           NA           NA   NA    NA   NA</span>
<span class="co">#&gt;            AC5  AC10</span>
<span class="co">#&gt; gamma    -0.01  0.00</span>
<span class="co">#&gt; omega_1   0.05  0.04</span>
<span class="co">#&gt; omega_2  -0.01  0.07</span>
<span class="co">#&gt; theta     0.02 -0.02</span>
<span class="co">#&gt; DIC      -0.06  0.09</span>
<span class="co">#&gt; deviance -0.06  0.09</span>
<span class="co">#&gt; pD          NA    NA</span></pre></body></html></div>
<p>The <code><a href="../reference/check_mobility.html">check_mobility()</a></code> function provides goodness of fit metrics and summary plots.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/check_mobility.html">check_mobility</a></span>(<span class="no">M</span>, <span class="no">D</span>, <span class="no">N</span>, <span class="no">mod</span>)</pre></body></html></div>
<p><img src="V4_gravity_model_files/figure-html/check-1.png" width="696"></p>
<pre><code>#&gt; $DIC
#&gt; [1] 35327.55
#&gt; 
#&gt; $RMSE
#&gt; [1] 776.6571
#&gt; 
#&gt; $MAPE
#&gt; [1] 4.823927
#&gt; 
#&gt; $R2
#&gt; [1] 0.9047936</code></pre>
<p>Now that we have verified that our model fits the data adequately, we can simulate connectivity values among the off-diagonal locations by using the estimated parameter values from the fitted gravity model in the <code><a href="../reference/sim_gravity.html">sim_gravity()</a></code> function.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">pi_hat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/sim_gravity.html">sim_gravity</a></span>(<span class="kw">N</span><span class="kw">=</span><span class="no">N</span>,
                      <span class="kw">D</span><span class="kw">=</span><span class="no">D</span>,
                      <span class="kw">theta</span><span class="kw">=</span><span class="no">mod</span>[<span class="st">'theta'</span>, <span class="st">'Mean'</span>],
                      <span class="kw">omega_1</span><span class="kw">=</span><span class="no">mod</span>[<span class="st">'omega_1'</span>, <span class="st">'Mean'</span>],
                      <span class="kw">omega_2</span><span class="kw">=</span><span class="no">mod</span>[<span class="st">'omega_2'</span>, <span class="st">'Mean'</span>],
                      <span class="kw">gamma</span><span class="kw">=</span><span class="no">mod</span>[<span class="st">'gamma'</span>, <span class="st">'Mean'</span>])</pre></body></html></div>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">pi_hat</span>) <span class="kw">&lt;-</span> <span class="fl">NA</span>

<span class="fu">ggplot</span>(<span class="kw">data</span><span class="kw">=</span><span class="fu">melt</span>(<span class="no">pi_hat</span>)) +
  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="kw">x</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">destination</span>),
                <span class="kw">y</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">origin</span>),
                <span class="kw">fill</span><span class="kw">=</span><span class="no">value</span>)) +
  <span class="fu">xlab</span>(<span class="st">'Destination'</span>) + <span class="fu">ylab</span>(<span class="st">"Origin"</span>) +
  <span class="fu">theme_bw</span>() + <span class="fu">theme</span>(<span class="kw">axis.text.x</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">10</span>),
                     <span class="kw">axis.text.y</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">10</span>),
                     <span class="kw">axis.title.x</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">12</span>, <span class="kw">margin</span> <span class="kw">=</span> <span class="fu">margin</span>(<span class="kw">t</span> <span class="kw">=</span> <span class="fl">15</span>)),
                     <span class="kw">axis.title.y</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">12</span>, <span class="kw">margin</span> <span class="kw">=</span> <span class="fu">margin</span>(<span class="kw">r</span> <span class="kw">=</span> <span class="fl">15</span>)),
                     <span class="kw">legend.position</span><span class="kw">=</span><span class="st">'bottom'</span>) +
  <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_fill_viridis</a></span>(<span class="kw">option</span><span class="kw">=</span><span class="st">'inferno'</span>, <span class="kw">direction</span><span class="kw">=</span><span class="fl">1</span>) +
  <span class="fu">guides</span>(<span class="kw">fill</span><span class="kw">=</span><span class="fu">guide_colorbar</span>(<span class="kw">title</span><span class="kw">=</span><span class="st">'Observed proportion of trips'</span>,
                             <span class="kw">title.position</span><span class="kw">=</span><span class="st">'top'</span>,
                             <span class="kw">label.theme</span><span class="kw">=</span><span class="fu">element_text</span>(<span class="kw">size</span><span class="kw">=</span><span class="fl">9</span>),
                             <span class="kw">barwidth</span><span class="kw">=</span><span class="fl">20</span>,
                             <span class="kw">barheight</span><span class="kw">=</span><span class="fl">0.5</span>,
                             <span class="kw">frame.colour</span><span class="kw">=</span><span class="st">'black'</span>,
                             <span class="kw">ticks</span><span class="kw">=</span><span class="fl">TRUE</span>))</pre></body></html></div>
<p><img src="V4_gravity_model_files/figure-html/sim_plot-1.png" width="624"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Giles, Amy Wesolowski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
